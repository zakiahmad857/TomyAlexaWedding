<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="utf-8">

  <title>Tomy & Lexa | Virtual Wedding Reception</title>
  <link rel="icon" href="images/favicon-16.png">

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-tour/0.12.0/css/bootstrap-tour-standalone.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.css">

  <!-- CSS Stylesheet  -->
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/home.css">

</head>

<body>

  <div class="mobile-content">
    <h1>Please access this website from desktop</h1>
    <h2>Can't wait to see you!</h2>
  </div>

  <div class="browser-resize">
    <h1>Please maximize your browser for the full experience</h1>
  </div>

  <div class="browser-resize-max">
    <h1>Please minimize your browser for the full experience</h1>
  </div>

  <div class="desktop-content">
    <!-- lOADER -->
    <div id="loading" class="loader">
      <img src="images/loading.svg" alt="loading" />
    </div>

    <!-- MODALS -->
    <!-- WELCOMING MODAL -->
    <div id="welcomeModal" class="modal">

      <div class="modal-content content-welcome">
        <h4 class="lang" key="welcome">Selamat Datang</h4>
        <h5 id="welcomeName"></h5>
        <p class="lang lang-head" key="language">Pilih Bahasa</p>

        <div id="checkbox-container" class="lang-wrapper">
          <div class="mx-auto">
            <label class="option_item">
              <input type="checkbox" id="checkbox-ind" class="checkbox">
              <div class="option_inner">
                <img src="images/lang/indonesia.png" class="flag" alt="indonesia">
              </div>
            </label>
            <label class="option_item">
              <input type="checkbox" id="checkbox-eng" class="checkbox">
              <div class="option_inner">
                <img src="images/lang/united-kingdom.png" class="flag" alt="indonesia">
              </div>
            </label>
          </div>
        </div>

        <button type="button" class="btn-modal" id="btn-welcome" name="okay">Next</button>
      </div>

    </div>

    <!-- WELCOMING MODAL - EARLY BIRD -->
    <div id="earlyBird" class="modal">

      <div class="modal-content content-earlyBird">
        <h4 class="lang" key="earlyBird_1">Video Call Access</h4>
        <h6 class="lang" key="earlyBird_2">We will give you the video call access in</h6>
        <div class="timer">
          <span id="hours"></span>
          <span id="minutes"></span>
          <span id="seconds"></span>
        </div>
        <h6 class="lang" key="earlyBird_3">The video call access will show up automatically when the countdown is done.</h6>
        <p>(screenshot popupnya nanti)</p>
        <h6 class="lang" key="earlyBird_4">While waiting, let us show you around the "Reception Venue"</h6>
        <button type="button" class="btn-modal" id="btn-next" name="next">Next</button>
      </div>

    </div>

    <!-- Video Call Modal -->
    <div id="vcallModal" class="modal">

      <div class="modal-content content-vcall">
        <h4> <span id="redirectVcall"></span></h4>
        <h4 class="lang" key="vcall_1"> detik lagi Anda akan menuju halaman video call</h4>
        <h6 class="lang" key="vcall_2">You will be seated in the waiting room, you can explore the website after the video call</h6>
      </div>

    </div>

    <!-- Jam Karet Modal -->
    <div id="karetModal" class="modal">

      <div class="modal-content content-karet">
        <h6 class="lang" key="sorry">Whoops you’re late, we’re sorry you’re not able to meet Tomy & Lexa. Here some message from them..</h6>
        <iframe id="video" width="560" height="315" src="https://www.youtube.com/embed/xOsLIiBStEs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        <button type="button" class="btn-modal btn-videokaret" id="btn-karetModal" name="okay">Next</button>
      </div>

    </div>

    <!-- FAQ Modal -->
    <div id="faqModal" class="modal">
      <div class="modal-content content-faq">
        <span class="close">&times;</span>
        <h4 class="lang" key="">Frequently Asked Questions</h4>
      </div>
    </div>

    <!-- Angpao Modal -->
    <div id="angpaoModal" class="modal">

      <!-- Angpao Modal Content -->
      <div class="modal-content modal-angpao">
        <span class="close">&times;</span>
        <h5 class="lang" key="gift">Kirim hadiah dengan mudah :) wkwk</h5>
        <div class="qrcode-list">
          <div class="qrcode ovo">
            <p>Via OVO</p>
            <img src="images/angpao/ovo.png" alt="ovo">
          </div>
          <div class="qrcode">
            <p class="lang" key="bank">Via Transfer Bank</p>
            <img class="bca" src="images/angpao/bca.png" alt="ovo">
            <p><span class="lang" key="norek">No rekening </span>123456789</p>
            <p>Tomy Herseta</p>
          </div>
          <div class="qrcode gopay">
            <p>Via Gopay</p>
            <img src="images/angpao/gopay.png" alt="ovo">
          </div>
        </div>
      </div>

    </div>

    <!-- WEB CONTENT -->
    <div class="container-fluid homepage">

      <!-- Header -->
      <div class="header">

        <div id="checkbox-container2" class="header-div">
          <input type="checkbox" class="checkbox" id="toggleLang" />
          <label class="label" for="toggleLang">
            <img class="flag-circle uk" src="images/lang/uk-circle.png" alt="">
            <img class="flag-circle ind" src="images/lang/ind-circle.png" alt="">
            <div class="ball"></div>
          </label>

          <img id="info" class="header-icon info" src="images/information.svg" alt="">

          <img id="faq" class="header-icon" src="images/faq.svg" alt="">
        </div>

      </div>


      <div class="layer planet">
        <div id="idPlanet" class="">
          <a href="aisle/index.html"><img src="images/planet.png" alt=""></a>
        </div>
      </div>

      <div id="live-mc" class="live-mc"></div>
      <div class="video-mc">
        <div class="video-wrapper">
          <iframe id="videoMC" src="https://www.youtube.com/embed/MqePxS6iyvA?enablejsapi=1&autoplay=1" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
          <!-- <iframe id="videoMC" src="https://www.youtube.com/embed/Mqs0I8lEoKA?enablejsapi=1&autoplay=1" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe> -->
        </div>
      </div>

      <div class="parent-angpao">
        <div id="angpao" class="div-ayam"></div>
        <div class="angpao"></div>
        <img src="images/png-seq/staticayam.png" alt="">
      </div>

      <div class="parent-souvenir">
        <a href="souvenir/index.html">
          <div id="souvenir" class="div-souvenir"></div>
          <div class="souvenir"></div>
          <img src="images/png-seq/statickaset.png" alt="">
        </a>
      </div>

      <div class="parent-gallery">
        <a href="gallery/index.html">
          <div id="gallery" class="div-gallery"></div>
          <div class="gallery"></div>
        </a>
      </div>

      <div class="parent-jukebox">
        <a href="jukebox/index.html">
          <div id="jukebox" class="div-jukebox"></div>
          <div class="jukebox"></div>
          <img src="images/png-seq/jukebox.png" alt="">
        </a>
      </div>


    </div>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  <script src="  https://cdnjs.cloudflare.com/ajax/libs/bootstrap-tour/0.12.0/js/bootstrap-tour-standalone.min.js" charset="utf-8"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js" charset="utf-8"></script>

  <!-- js -->
  <script type="text/javascript" src="index.js"></script>

  <script type="text/javascript">
    // WEB TOUR
    var tour = new Tour({
      steps: [{
          element: "#gallery",
          title: "Gallery Foto & Video",
          content: "Kamu bisa melihat foto dan video Pre-Wed, Lamaran, serta Akad Pernikahan dari Tomy & Lexa ",
          placement: "right",
        },
        {
          element: "#idPlanet",
          title: "Pelaminan",
          content: "Di sini kamu bisa melihat siapa yang sedang bertemu dengan mempelai dan siapa yang ada di antrian berikutnya",
          placement: "bottom",
        },
        {
          element: "#angpao",
          title: "Donasi",
          content: "Kamu bisa memberikan rasa sayangmu untuk masa depan Tomy & Lexa di sini",
          placement: "right",
        },
        {
          element: "#souvenir",
          title: "Cinderamata",
          content: "Sebagai tanda terima kasih dari Tomy & Lexa, ada cinderamata untukmu di sini",
          placement: "top",
        },
        {
          element: "#jukebox",
          title: "Hiburan",
          content: "Nikmati hiburan pernikahan Tomy & Lexa di sini! Akan ada special performance dari Norrrm Radio dan teman-teman mereka",
          placement: "left",
        },
        {
          element: "#live-mc",
          content: "MC (nama) akan menemanimu selama acara berlangsung",
          placement: "top",
        },
        {
          element: "#info",
          title: "Instructions",
          content: "Jika kamu ingin membaca ulang petunjuk sebelumnya, silakan klik tombol ini",
          placement: "left",
        }
      ],
      container: 'body',
      backdrop: true,
      smartPlacement: true,
      keyboard: true,
      storage: window.localStorage,
      debug: false,
      autoscroll: false,
      backdropPadding: 0,
      redirect: true,
      template: '<div class="popover tour" role="tooltip"> <div class="arrow"></div> <h3 class="popover-title"></h3> <div class="popover-content"></div> <div class="popover-navigation"> <div class="btn-group"> <button class="btn btn-sm btn-prev" data-role="prev">Prev</button> <button class="btn btn-sm btn-next" data-role="next">Next</button> <button class="btn btn-sm btn-secondary" data-role="pause-resume" data-pause-text="Pause" data-resume-text="Resume">Pause</button> </div> <button class="btn btn-sm end" data-role="end">End tour</button> </div> </div>',
    });

    var tourEng = new Tour({
      steps: [{
          element: "#gallery",
          title: "Video & Photo Gallery",
          content: "Take a look of Lexa & Tomy’s Pre-Wedding, Engagement and Wedding Ceremony photos and videos here",
          placement: "right",
        },
        {
          element: "#idPlanet",
          title: "The Aisle",
          content: "Take a peak of who are currently meeting the bride & groom. You can also see who’s up in the line to meet them soon!",
          placement: "bottom",
        },
        {
          element: "#angpao",
          title: "Show your support here",
          content: "We have provided ways on how you can support Tomy & Lexa’s in their next season.",
          placement: "right",
        },
        {
          element: "#souvenir",
          title: "Wedding Souvenir",
          content: "As a thank you, Tomy & Lexa have a special little something for you to remember this precious moment with them",
          placement: "top",
        },
        {
          element: "#jukebox",
          title: "Entertainment",
          content: "Enjoy",
          placement: "left",
        },
        {
          element: "#live-mc",
          content: "MC (name) will accompany the guests during the event but we’re sorry he/she will only use Bahasa",
          placement: "top",
        },
        {
          element: "#info",
          title: "Instructions",
          content: "You can click this icon if you want to repeat the instructions",
          placement: "left",
        }
      ],
      container: 'body',
      backdrop: true,
      smartPlacement: true,
      keyboard: true,
      storage: window.localStorage,
      debug: false,
      autoscroll: false,
      backdropPadding: 0,
      redirect: true,
      template: '<div class="popover tour" role="tooltip"> <div class="arrow"></div> <h3 class="popover-title"></h3> <div class="popover-content"></div> <div class="popover-navigation"> <div class="btn-group"> <button class="btn btn-sm btn-prev" data-role="prev">Prev</button> <button class="btn btn-sm btn-next" data-role="next">Next</button> <button class="btn btn-sm btn-secondary" data-role="pause-resume" data-pause-text="Pause" data-resume-text="Resume">Pause</button> </div> <button class="btn btn-sm end" data-role="end">End tour</button> </div> </div>',
    });


    $("#info").click(function() {
      if (toggleLang.checked) {
        tourEng.restart();
      } else {
        tour.restart();
      }
    });

    // localStorage
    var welcomeState = localStorage.getItem("welcomeState");
    console.log("WELCOME STATE ");
    console.log(welcomeState);

    var karetState = localStorage.getItem("karetState");

    // Path
    var dirPath = dirname(location.href);

    function dirname(path) {
      return path.replace(/\\/g, '/').replace(/\/[^\/]*$/, '');
    }

    // TOKEN DATA
    var name = null;
    var idPosition = null;

    cookieToken = $.cookie("token");
    console.log("token " + cookieToken);

    console.log("localStorageeeeeee ");
    console.log(localStorage);
    // console.log(welcomeState);

    if (cookieToken == null) {
      var fullPath = dirPath + "/login";
      console.log(fullPath);
      window.location = fullPath;
    }

    $.ajax({
      url: "https://webnikahapi.arthatronic.com/api/user/",
      async: false,
      type: "GET",
      global: false,
      // Fetch the stored token from localStorage and set in the header
      headers: {
        "Authorization": "Token " + cookieToken
      },
      success: function(result) {
        console.log(result);
        name = result[0].name;
        timeSet = result[0].time;
        idPosition = result[0].id_room;
        console.log(name);
        console.log(timeSet);

      },
      error: function(err) {
        console.log(err);
      }
    });

    $("#welcomeName").html(name);

    // Admin langsung masuk concall
    if (idPosition == "9999" || idPosition == "9898" || idPosition == "9797" || idPosition == "9696" || idPosition == "8888") {
      var fullPath = dirPath + "/Vcall";
      console.log(fullPath);
      window.location = fullPath;
    }

    var endTime = new Date("18 August 2020 " + timeSet + " GMT+07:00");

    console.log("endtimeeeee" + endTime);

    endTime = (Date.parse(endTime) / 1000);

    var timeLeft;

    var stopVideo = function(element) {

      var iframe = element.querySelector('iframe');
      var video = element.querySelector('#video');
      if (iframe !== null) {
        var iframeSrc = iframe.src;
        iframe.src = iframeSrc;
      }
      if (video !== null) {
        video.pause();
      }

    };

    function makeTimer() {

      now = new Date();
      timeNow = now.getHours() + ":" + now.getMinutes() + ":" + now.getSeconds();

      timeNow = (Date.parse(now) / 1000);

      var timeLeft = endTime - timeNow;
      console.log("timeleft " + timeLeft);
      var days = Math.floor(timeLeft / 86400);
      var hours = Math.floor((timeLeft - (days * 86400)) / 3600);
      var minutes = Math.floor((timeLeft - (days * 86400) - (hours * 3600)) / 60);
      var seconds = Math.floor((timeLeft - (days * 86400) - (hours * 3600) - (minutes * 60)));

      if (hours < "10") {
        hours = "0" + hours;
      }
      if (minutes < "10") {
        minutes = "0" + minutes;
      }
      if (seconds < "10") {
        seconds = "0" + seconds;
      }

      $("#hours").html(hours + "<span> :</span>");
      $("#minutes").html(minutes + "<span> :</span>");
      $("#seconds").html(seconds);

      console.log(hours + ":" + minutes + ":" + seconds);

      // Popup Vcall
      if (timeLeft <= 0 && timeLeft >= -600) {

        localStorage.setItem('karetState', 'shown');

        if (localStorage.welcomeState != 'shown') {
          $("#welcomeModal").css("display", "block");
        } else if (localStorage.welcomeState == 'shown') {
          $("#earlyBird").css('display', 'none');
          $("#vcallModal").css('display', 'block');
        }

        $("#btn-welcome").click(function() {
          $("#welcomeModal").css("display", "none");
          localStorage.setItem('welcomeState', 'shown');
          console.log("GANTI WELCOME STATE ");
          console.log(localStorage);
          console.log(localStorage.welcomeState);

          tour.end();
          tourEng.end();

        });

        tour.end();
        tourEng.end();

        var counterVcall = 10;
        var interval = setInterval(function() {
          // Display 'counter' wherever you want to display it.
          $("#redirectVcall").html(counterVcall);
          counterVcall--;

          console.log(counterVcall);
          if (counterVcall == 0) {
            // Display a login box
            clearInterval(interval);
            $("#vcallModal").css('display', 'block');
            console.log(dirPath);
            var fullPath = dirPath + "/Vcall";
            console.log(fullPath);
            window.location = fullPath;
            // return false;
          }
        }, 1000);

      }

      // Concall masih agak lama, Explore web
      if (timeLeft > 0) {

        localStorage.setItem('karetState', 'shown');

        $("#btn-welcome").click(function() {
          $("#welcomeModal").css("display", "none");
          $("#earlyBird").css("display", "block");
        });

        $("#btn-next").click(function() {
          $("#earlyBird").css("display", "none");
          $("#welcomeModal").css("display", "none");
          if (toggleLang.checked) {
            tourEng.restart();
          } else {
            tour.restart();
          }
        });

      }

      // Tamu tanpa concall dan Jam karet
      if (timeLeft < -600) {

        // Tamu biasa tanpa concall
        if (idPosition == "0000") {

          localStorage.setItem('karetState', 'shown');

          $("#btn-welcome").click(function() {
            $("#welcomeModal").css("display", "none");
            $("#earlyBird").css('display', 'none');
            $("#karetModal").css('display', 'none');
            $("#vcallModal").css('display', 'none');
            if (toggleLang.checked) {
              tourEng.restart();
            } else {
              tour.restart();
            }
          });

        } else {

          // Tamu ngaret

          $("#btn-welcome").click(function() {
            $("#karetModal").css('display', 'block');
            $("#welcomeModal").css("display", "none");
          });

        }
      }
    }
    // end of function maketimercall


    if (localStorage.welcomeState != 'shown') {

      $("#welcomeModal").css('display', 'block');

      $("#checkbox-ind").click(function() {
        $("#toggleLang").prop('checked', false);
      });

      $("#checkbox-eng").click(function() {
        $("#toggleLang").prop('checked', true);
      });

      setInterval(function() {
        makeTimer();
      }, 1000);

    }


    /// Inject YouTube API script
    var tag = document.createElement('script');
    tag.src = "https://www.youtube.com/player_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    var player;

    function onYouTubePlayerAPIReady() {
      // create the global player from the specific iframe (#video)
      player = new YT.Player('videoMC', {
        events: {
          // call this function when player is ready to use
          'onReady': onPlayerReady
        }
      });
    }

    function onPlayerReady(event) {

      console.log("event");
      console.log(event);
      // bind events
      if (localStorage.karetState != 'shown') {
        player.mute();
        console.log("MUTE");
        console.log("karetState " + localStorage.karetState);
      }
      $("#btn-karetModal").click(function() {

        console.log("BUTTON CLICK UNMUTE");

        $("#karetModal").css("display", "none");
        $("#earlyBird").css("display", "none");
        $("#welcomeModal").css("display", "none");
        localStorage.setItem('karetState', 'shown');

        console.log("karetState 2 " + localStorage.karetState);

        // stopVideo(document);
        console.log("UNMUTE");
        player.unMute();


        if (toggleLang.checked) {
          tourEng.restart();
        } else {
          tour.restart();
        }

        // stop popup video
        stopVideo(document);
      });
    }
  </script>

</body>

</html>
