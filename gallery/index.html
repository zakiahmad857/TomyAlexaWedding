<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="utf-8">
  <meta property="og:image" itemprop="image" content="/images/bride.png">
  <meta property="og:description" content="Tomy & Alexa Virtual Wedding Reception">

  <title>Tomy & Lexa | Virtual Wedding Reception</title>
  <link rel="icon" href="images/favicon-16.png">

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-tour/0.12.0/css/bootstrap-tour-standalone.min.css">

  <!-- CSS Stylesheet  -->
  <link rel="stylesheet" href="../css/style.css">

</head>

<body>
  <div class="container-fluid gallery-page">

    <!-- Video Call Modal -->
    <div id="vcallModal" class="modal">

      <div class="modal-content content-vcall">
        <h4><span id="redirectVcall2"></span></h4>
        <h4 class="lang" key="vcall_1"> detik lagi Anda akan menuju halaman video call</h4>
        <h6 class="lang" key="vcall_2">You will be seated in the waiting room, you can explore the website after the video call</h6>
        <!-- <a href="Vcall/index.html"><button type="button" class="btn-modal" id="btn-okay" name="okay">Okay</button></a> -->
      </div>

    </div>

    <!-- Header -->
    <div class="header header-gallery">

      <div id="checkbox-container2" class="header-div">
        <input type="checkbox" class="checkbox" id="toggleLang" />
        <label class="label" for="toggleLang">
          <img class="flag-circle uk" src="../images/lang/uk-circle.png" alt="">
          <img class="flag-circle ind" src="../images/lang/ind-circle.png" alt="">
          <div class="ball"></div>
        </label>

        <!-- <img id="info" class="header-icon info" src="../images/information.svg" alt=""> -->

        <!-- <img id="faq" class="header-icon" src="../images/faq.svg" alt=""> -->

        <img class="exit header-icon" src="../images/exit.svg" alt="">
      </div>
    </div>

      <h1>Gallery Page</h1>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-tour/0.12.0/js/bootstrap-tour-standalone.min.js" charset="utf-8"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js" charset="utf-8"></script>
  <script type="text/javascript" src="../index.js"></script>
  <!-- <script type="text/javascript" src="../gotoconcall.js"></script> -->
  <script type="text/javascript">

  var dirPath = dirname(location.href);
  var homePath = RemoveLastDirectoryPartOf(dirPath);

  function dirname(path) {
    return path.replace(/\\/g, '/').replace(/\/[^\/]*$/, '');
  }

  function RemoveLastDirectoryPartOf(the_url) {
    var the_arr = the_url.split('/');
    the_arr.pop();
    return (the_arr.join('/'));
  }

  // TOKEN DATA
  var name = null;
  var timeSet = null;
  var groupVcall = [];

  console.log("array");
  console.log(groupVcall.length);

  cookieToken = $.cookie("token");
  console.log("token " + cookieToken);

  if (cookieToken == null) {
    var fullPath = dirPath + "/login";
    console.log(fullPath);
    window.location = fullPath;
  }

  // Time group
  var cekWaktu = new Date();
  var minuteBulat = parseInt(cekWaktu.getMinutes()) - (parseInt(cekWaktu.getMinutes())%5);

  timeGroup = cekWaktu.getHours() + ":" + minuteBulat.toString();

  $.ajax({
    url: "https://webnikahapi.arthatronic.com/api/user/" + timeGroup,
    async: false,
    type: "GET",
    global: false,
    success: function(result) {
      console.log("get time group");
      console.log(result);
      for(var i=0; i<result.length; i++){
        var item = result[i].username;
        groupVcall.push(item);
      }
      console.log(groupVcall);
    },
    error: function(err) {
      console.log(err);
    }
  });

  $.ajax({
    url: "https://webnikahapi.arthatronic.com/api/user/",
    async: false,
    type: "GET",
    global: false,
    // Fetch the stored token from localStorage and set in the header
    headers: {
      "Authorization": "Token " + cookieToken
    },
    success: function(result) {
      console.log("get data user");
      console.log(result);
      name = result[0].name;
      timeSet = result[0].time;
      console.log(name);
      console.log(timeSet);

    },
    error: function(err) {
      console.log(err);
    }
  });

  console.log("nama homepage " + name);
  $("#welcomeName").html(name);

  // cek manual
  // var now = new Date();
  // var timeNow = now.getHours() + ":" + now.getMinutes() + ":" + now.getSeconds();
  // var endTime = new Date("5 August 2020 " + now.getHours().toString() + ":" + now.getMinutes().toString() + ":" + parseInt(now.getSeconds()).toString() + " GMT+07:00");


  var endTime = new Date("7 August 2020 " + timeSet + " GMT+07:00");

  console.log("endtimeeeee" + endTime);
  // endTime = (Date.parse(endTime) / 1000) + 10;

  endTime = (Date.parse(endTime) / 1000);

  var welcomeState = localStorage.getItem("welcomeState");

  function makeTimer() {

    // var endTime = new Date("5 August 2020 " + timeSet + " GMT+07:00");

    // manual
    now = new Date();
    timeNow = now.getHours() + ":" + now.getMinutes() + ":" + now.getSeconds();

    // var endTime = new Date("6 August 2020 17:38:05 GMT+07:00");

    timeNow = (Date.parse(now) / 1000);

    var timeLeft = endTime - timeNow;
    console.log("timeleft " + timeLeft);
    var days = Math.floor(timeLeft / 86400);
    var hours = Math.floor((timeLeft - (days * 86400)) / 3600);
    var minutes = Math.floor((timeLeft - (days * 86400) - (hours * 3600)) / 60);
    var seconds = Math.floor((timeLeft - (days * 86400) - (hours * 3600) - (minutes * 60)));

    if (hours < "10") {
      hours = "0" + hours;
    }
    if (minutes < "10") {
      minutes = "0" + minutes;
    }
    if (seconds < "10") {
      seconds = "0" + seconds;
    }

    $("#hours").html(hours + "<span> :</span>");
    $("#minutes").html(minutes + "<span> :</span>");
    $("#seconds").html(seconds);

    console.log(hours + ":" + minutes + ":" + seconds);

    // Popup Vcall
    if (timeLeft <= 0 && timeLeft >= -600) {
      $("#welcomeModal").css('display', 'none');
      $("#earlyBird").css('display', 'none');
      $("#vcallModal").css('display', 'block');

      console.log("nol");

      var counterVcall = 5;
      var interval = setInterval(function() {
        // Display 'counter' wherever you want to display it.
        $("#redirectVcall2").html(counterVcall);
        counterVcall--;
        console.log("masuk counter");
        console.log(counterVcall);
        if (counterVcall == 0) {
          // Display a login box
          clearInterval(interval);
          $("#vcallModal").css('display', 'block');
          console.log(dirPath);
          var fullPath = homePath + "/Vcall";
          console.log(fullPath);
          window.location = fullPath;
          // return false;
        }
      }, 1000);
    }

    // Jam Karet
    if (timeLeft > 0) {
      // Select language @ modal
      $("#checkbox-ind").click(function() {
        $("#toggleLang").prop('checked', false);

        // close modal, pop user modal
        $("#welcomeModal").delay(1000).queue(function(next) {
          $("#welcomeModal").css("display", "none");
          $("#earlyBird").css("display", "block");
        });
      });

      $("#checkbox-eng").click(function() {
        $("#toggleLang").prop('checked', true);

        $("#welcomeModal").delay(1000).queue(function(next) {
          $("#welcomeModal").css("display", "none");
          $("#earlyBird").css("display", "block");
        });
      });
    }

    if (timeLeft < -600) {
      $("#checkbox-ind").click(function() {
        $("#welcomeModal").delay(1000).queue(function(next) {
          $("#earlyBird").css('display', 'none');
          $("#karetModal").css('display', 'block');
        });
      });
      $("#checkbox-eng").click(function() {
        $("#welcomeModal").delay(1000).queue(function(next) {
          $("#earlyBird").css('display', 'none');
          $("#karetModal").css('display', 'block');
        });
      });
    }
  }

  setInterval(function() {
    makeTimer();
  }, 1000);

  $("#btn-next-2").click(function() {
    $("#welcomeModal").css('display', 'none');
    $("#earlyBird").css('display', 'none');
  });

  </script>

</body>

</html>
